{"title":"Power analysis and Bayesian priors","markdown":{"yaml":{"title":"Power analysis and Bayesian priors","date":"2025-02-19","toc":true},"headingText":"Load library","containsRefs":false,"markdown":"\n\n\n```{r load libraries , warning=FALSE,message=FALSE}\nlibrary(magrittr)\nlibrary(tidyverse)\n#library(rstanarm) # bayesian package\n#library(bayesplot)\n#library(tidybayes)\nlibrary(brms)\nlibrary(broom)\nlibrary(purrr)\nlibrary(marginaleffects)\nlibrary(patchwork)\nlibrary(cowplot)\nlibrary(gt)\nlibrary(gtsummary)\n#library(rstan)\noh_cols<- c('#50BECB',\t'#46A6B2',\t'#65C9D5',\t'#97D3DC',\t'#CDEBF0',\t'#EDE668',\t'#AA1E2D',\t'#E4E5E3',\t'#F26828',\t'#DC5C1D',\t'#F89C70',\t'#FDCEB0',\t'#2A3C47',\t'#18272F',\t'#404C58',\t'#646A74',\t'#C3C3C8',\t'#74308C')\noh_cols<- c('#65C9D5',\t'#EDE668',\t'#AA1E2D',\t'#F26828',\t'#FDCEB0',\t'#C3C3C8',\t'#74308C','#18272F')\n\nbrms_summary <- function(x) {\n  posterior::summarise_draws(x, \"mean\", \"sd\",  ~quantile(.x, probs = c(0.8,0.95)))\n}\n\n```\n\n# Establishing Bayesian priors, mcid, and similarity interval\n\nThe goal of this script is to showcase the code for conducting a Bayesian power analysis. Code is not run because it takes too long for code to execute. In brief, the Bayesian operating characteristics are specified: minimal clinical important difference (MCID), similarity interval (+/- MCID centered around 0), prior distributions, and expected effect size for a binary outcome. Power here is thought of as meeting a specified probability benefit (specified by clinician). So data are simulated for a specified effect and the posterior is evaluated for each simulated dataset. \\\n\nI like to visualize the prior distributions to see how they look. The code works for simulating under a specified sample size and the code will have to be re-run if you want to compare with other sample sizes. \\\n\n-   the MCID is log(0.8) or `r log(0.8)`\\\n-   the similarity interval is \\[`r log(0.8)` - `r log(1.2)`\\]\n\n```{r graphing bayesian priors}\n\n#priors\n#lets see range of OR in log scale\nordat<-round(tibble(or=c(0.2,0.5,0.8,1,1.2,2,4,5),logor=log(or)),3) # +/- 1.61\n\n\nprior.plot<-ggplot(data = tibble(x = -1.61:1.61), aes(x)) +annotate(xmin=log(.8),xmax=log(1.2),ymin=0,ymax=0.8,'rect',alpha=.5)+\n  stat_function(fun = dnorm, n = 101, args = list(0,.5),aes(colour=\"Skeptical\"),linewidth=2) +\n  stat_function(fun = dnorm, n = 101, args = list(log(0.8),.5),linewidth=2,aes(colour=\"Enthusiastic\")) +theme_bw()+xlab(\"Log-odds ratio\")+ylab(\"Density\")+scale_x_continuous(limits=c(-1.61,1.61),labels =ordat$logor,breaks=ordat$logor,sec.axis = dup_axis(name=\"Odds ratio\",labels=ordat$or))+scale_colour_manual(breaks=c(\"Skeptical\",\"Enthusiastic\"),values=c(\"#97D3DC\",\"#F89C70\"),name=\"Prior\")+theme(legend.position=\"top\")+annotate(\"text\",x=0,y=.02,label=\"Similarity interval\")\n\nprior.plot\n\n#ggsave(prior.plot,filename=\"../02_Results_figures/Prior plot.png\",width=7,height=5,units=\"in\",dpi=600)\n\n\n## skeptical prior is normal(0,0.5)\n\n\n```\n\n# Power analysis\n\n## fitting initial model\n\nThis part of the script will be useful for the real analysis, which includes fitting the logistic model, checking the model, and testing hypotheses.\n\n```{r power analysis, eval=FALSE}\nn=100\nd<- tibble(group = rep(c(\"control\", \"treatment\"), each = n))|>\n  mutate(treatment = ifelse(group == \"control\", 0, 1),\n         y         = ifelse(group == \"control\", \n                            rbinom(n,1,.2),\n                            rbinom(n,1,.1)))\n\n##########optimized code \n\n#fit a brms model with skeptical prior\nfit <-brm(data = d,\n      family = binomial,\n      y|trials(1) ~ 0+ Intercept + treatment,\n      prior = c(prior(normal(0,.5), class = b),prior(normal(0,0.5),class=b,coef=\"Intercept\")),\n      seed = 1,chains=6,iter=10000,warmup=1000,cores=4)\nplot(fit) # see chains\nprint(fit) # check rhat and model output\n\n###posterior predictive checks \npp_check(fit,type=\"stat\",stat=\"mean\")\npp_check(fit,stat=\"mean\",ndraws=50)\n\n\n# get other quantiles \nbrms_summary(fit)|>\n  data.frame()|>\n  filter(variable==\"b_treatment\")\n\n#get priors\nget_prior(fit)\n#marginal effects\n\n\n#test hypotheses\n# test treatment <0, overall benefit\nob<-hypothesis(fit,\"treatment<0\",alpha=0.025)\nob\n##### clinical benefit, treatment< log(.8)\ncb<-hypothesis(fit,\"treatment<log(0.8)\",alpha=0.025)\ncb\n\n###test for similarity ; within log(0.8)-log(1.2)\nsi1<-hypothesis(fit,\"treatment < log(1.2)\",alpha=0.025)\nsi2<-hypothesis(fit,\"treatment <log(0.8)\",alpha=0.025)\nsi1$hypothesis$Post.Prob-si2$hypothesis$Post.Prob\n\n\n\n# dobule check my understanding by manually calculating probs\nsamples<-as.data.frame(fit)\nn<-length(samples$b_treatment)\n\n#manual for overall benefit\nsum(samples$b_treatment<0)/n\n#manual for clinical benefit\nsum(samples$b_treatment<log(0.8))/n\n#similarity interval \nsum(samples$b_treatment>log(0.8) & samples$b_treatment<log(1.2))/n\n\n#### hypothesis function and manual calculations are in agreement #####\n\n##plotting out the treatment effect \nsubs<-tibble(treatment=samples$b_treatment)|>\n  mutate(Prior=\"Skeptical\")\nmean.paste<-paste(round(exp(mean(subs$treatment)),3),\" odds ratio\\n\",round(mean(subs$treatment),3),\"  log odds ratio\",sep=\"\")\nmp<-round(mean(subs$treatment),3)\n\nggplot(subs,aes(x=treatment,..scaled..))+geom_density(fill='#46A6B2',alpha=.5)+theme_bw()+xlab(\"Treatment effect (log odds ratio)\")+\n  scale_x_continuous(limits=c(-2.302585,1.61),labels =c(-2.302,ordat$logor),breaks=c(-2.302585,ordat$logor),sec.axis = dup_axis(name=\"Treatment effect (odds ratio)\",labels=c(0.1,ordat$or)))+\n  scale_y_continuous(expand=c(0,0),limits=c(0,1.3))+\n  annotate(xmin=log(.8),xmax=log(1.2),ymin=0,ymax=1.3,'rect',alpha=.5)+\n  annotate(\"text\",x=mp,y=1.15,label = mean.paste)+\n  annotate(\"text\",x=0.182,y=1.2,label=\"Similarity interval\",hjust=-.05)+ylab(\"Density\")+\n  geom_vline(xintercept = -.223,linewidth=1,lty=\"dotdash\")\n\n#########################################################\n### refit with enthusiastic prior ###################\n#########################################################\nep.fit<-brm(data = d,\n      family = binomial,\n      y|trials(1) ~ 0+ Intercept + treatment,\n      prior = c(prior(normal(log(0.8),.5), class = b),prior(normal(0,0.5),class=b,coef=\"Intercept\")),\n      seed = 1,chains=6,iter=10000,warmup=1000,cores=4)\n\n#chekcing ep.fit model \nplot(ep.fit) # see chains\nprint(ep.fit) # check rhat and model output\n\n###posterior predictive checks \npp_check(ep.fit,type=\"stat\",stat=\"mean\")\npp_check(ep.fit,stat=\"mean\",ndraws=50)\n\n\n##get posterier draws \nep.samples<-as.data.frame(ep.fit)\nep.subs<-tibble(treatment=ep.samples$b_treatment)|>\n  mutate(Prior=\"Enthusiastic\")\n\n###make combined figure \ntfit<-rbind(subs,ep.subs)\n\ntfig<-ggplot(tfit,aes(x=treatment,..scaled..,fill=Prior))+geom_density(alpha=.5)+theme_bw()+xlab(\"Treatment effect (log odds ratio)\")+\n  scale_x_continuous(limits=c(-2.302585,log(1.2)),labels =c(-2.302,ordat$logor),breaks=c(-2.302585,ordat$logor),sec.axis = dup_axis(name=\"Treatment effect (odds ratio)\",labels=c(0.1,ordat$or)))+\n  scale_y_continuous(expand=c(0,0),limits=c(0,1.3))+\n  annotate(xmin=log(.8),xmax=log(1.2),ymin=0,ymax=1.3,'rect',alpha=.5)+\n  #annotate(\"text\",x=mp,y=1.15,label = mean.paste)+\n  #annotate(\"text\",x=0.182,y=1.2,label=\"Similarity interval\",hjust=-.05)+ylab(\"Density\")+\n  geom_vline(xintercept = -.223,linewidth=1,lty=\"dotdash\")+\n  theme(legend.position = \"bottom\")+ylab(\"Scaled density\")+\n  scale_fill_manual(values=c(\"#97D3DC\",\"#F89C70\"))+\n  geom_vline(xintercept=0,linewidth=.25)\ntfig\n#####################\n###build a table to summarize the trial results\n#####################\ntbl<-tfit|>\n  group_by(Prior)|>\n  summarize(OR=round(mean(exp(treatment)),3),LCI=round(exp(quantile(treatment,probs = 0.025)),2),UCI=round(exp(quantile(treatment,probs = 0.975)),2),`Clinical Benefit`=round(sum(if_else(treatment<log(0.8),1,0))/length(treatment),2),\n            )|>\n  mutate(CI=paste(LCI,\"-\",UCI,sep=\"\"))|>\n  select(Prior,OR,CI,`Clinical Benefit`)|>\n  gt()|>tab_style(\n    style = list(\n      cell_text(weight = \"bold\",align=\"center\")\n      ),\n    locations = cells_column_labels(columns = c(Prior,OR,CI,`Clinical Benefit`))\n    ) |>\n  cols_align(\n  align = \"center\",\n  columns = everything()\n)|>\n  tab_footnote(footnote=\"Skeptical prior ~ Normal(0,0.5)\",\n               locations = cells_column_labels(columns = Prior))|>\n  tab_footnote(footnote=\"Enthusiastic prior ~ Normal(-0.2231436,0.5)\",\n               locations = cells_column_labels(columns = Prior))|>\n  tab_footnote(footnote=\"Pr(Treatment<MCID)\",\n               locations = cells_column_labels(columns = `Clinical Benefit`))|>\n  tab_footnote(footnote=\"95% Bayesian Confidence Interval\",\n               locations = cells_column_labels(columns = CI))\n\n#`Overall Benefit [Pr(Treatment <0)]`=round(sum(if_else(treatment<0,1,0))/length(treatment),2)\ntbl\ngtsave(tbl,filename=\"../02_results_figures/prior_table.png\")\n\n###############################################################\n#####combining the table into the figure \n##########################################\ncfig<-ggdraw(tfig)+draw_image(\"../02_results_figures/prior_table.png\",hjust=-.26,width=.4,height=.4,vjust=-1.2)\ncfig\n\nggsave(cfig,filename=\"../02_results_figures/rct_figure.png\",width=7,height=5,dpi=600,unit=\"in\")\n```\n\n## simulation for power analysis -\\> 1000 simulations\n\n```{r simulation and fit,eval=FALSE}\n####fit simulate and fit\n\n\nsimfit <- function(seed, n) {\n  \n  set.seed(seed)\n  \n  d<- tibble(group = rep(c(\"control\", \"treatment\"), each = n))|>\n  mutate(treatment = ifelse(group == \"control\", 0, 1),\n         y         = ifelse(group == \"control\", \n                            rbinom(n,1,.2),\n                            rbinom(n,1,.1)))\n  \n  update(fit,\n         newdata = d, \n         seed = seed) |>\n    brms_summary()|>\n  data.frame()|>\n  filter(variable==\"b_treatment\")\n    #fixef() |>\n    #data.frame() |>\n    #rownames_to_column(\"parameter\") |>\n    #filter(parameter == \"treatment\")\n}\n#actual simulations \nn_sim<-1000 # number of simulations\nsim1 <-\n  tibble(seed = 1:n_sim) %>% \n  mutate(b1 = map(seed, simfit, n = 100)) %>% \n  unnest(b1)\nsim1\n#calculate power\nsim1|> \n  mutate(check = ifelse(X95. < 0, 1, 0),\n         mcid=if_else(X80.< -0.2231436,1,0),\n         total=if_else(check&mcid==1,1,0)) |>\n  summarise(power = mean(check),power2=mean(mcid),ptotal=mean(total))\n\n\n```\n\n# session info\n\n```{r session info}\nsessionInfo()\n```\n","srcMarkdownNoYaml":"\n\n# Load library\n\n```{r load libraries , warning=FALSE,message=FALSE}\nlibrary(magrittr)\nlibrary(tidyverse)\n#library(rstanarm) # bayesian package\n#library(bayesplot)\n#library(tidybayes)\nlibrary(brms)\nlibrary(broom)\nlibrary(purrr)\nlibrary(marginaleffects)\nlibrary(patchwork)\nlibrary(cowplot)\nlibrary(gt)\nlibrary(gtsummary)\n#library(rstan)\noh_cols<- c('#50BECB',\t'#46A6B2',\t'#65C9D5',\t'#97D3DC',\t'#CDEBF0',\t'#EDE668',\t'#AA1E2D',\t'#E4E5E3',\t'#F26828',\t'#DC5C1D',\t'#F89C70',\t'#FDCEB0',\t'#2A3C47',\t'#18272F',\t'#404C58',\t'#646A74',\t'#C3C3C8',\t'#74308C')\noh_cols<- c('#65C9D5',\t'#EDE668',\t'#AA1E2D',\t'#F26828',\t'#FDCEB0',\t'#C3C3C8',\t'#74308C','#18272F')\n\nbrms_summary <- function(x) {\n  posterior::summarise_draws(x, \"mean\", \"sd\",  ~quantile(.x, probs = c(0.8,0.95)))\n}\n\n```\n\n# Establishing Bayesian priors, mcid, and similarity interval\n\nThe goal of this script is to showcase the code for conducting a Bayesian power analysis. Code is not run because it takes too long for code to execute. In brief, the Bayesian operating characteristics are specified: minimal clinical important difference (MCID), similarity interval (+/- MCID centered around 0), prior distributions, and expected effect size for a binary outcome. Power here is thought of as meeting a specified probability benefit (specified by clinician). So data are simulated for a specified effect and the posterior is evaluated for each simulated dataset. \\\n\nI like to visualize the prior distributions to see how they look. The code works for simulating under a specified sample size and the code will have to be re-run if you want to compare with other sample sizes. \\\n\n-   the MCID is log(0.8) or `r log(0.8)`\\\n-   the similarity interval is \\[`r log(0.8)` - `r log(1.2)`\\]\n\n```{r graphing bayesian priors}\n\n#priors\n#lets see range of OR in log scale\nordat<-round(tibble(or=c(0.2,0.5,0.8,1,1.2,2,4,5),logor=log(or)),3) # +/- 1.61\n\n\nprior.plot<-ggplot(data = tibble(x = -1.61:1.61), aes(x)) +annotate(xmin=log(.8),xmax=log(1.2),ymin=0,ymax=0.8,'rect',alpha=.5)+\n  stat_function(fun = dnorm, n = 101, args = list(0,.5),aes(colour=\"Skeptical\"),linewidth=2) +\n  stat_function(fun = dnorm, n = 101, args = list(log(0.8),.5),linewidth=2,aes(colour=\"Enthusiastic\")) +theme_bw()+xlab(\"Log-odds ratio\")+ylab(\"Density\")+scale_x_continuous(limits=c(-1.61,1.61),labels =ordat$logor,breaks=ordat$logor,sec.axis = dup_axis(name=\"Odds ratio\",labels=ordat$or))+scale_colour_manual(breaks=c(\"Skeptical\",\"Enthusiastic\"),values=c(\"#97D3DC\",\"#F89C70\"),name=\"Prior\")+theme(legend.position=\"top\")+annotate(\"text\",x=0,y=.02,label=\"Similarity interval\")\n\nprior.plot\n\n#ggsave(prior.plot,filename=\"../02_Results_figures/Prior plot.png\",width=7,height=5,units=\"in\",dpi=600)\n\n\n## skeptical prior is normal(0,0.5)\n\n\n```\n\n# Power analysis\n\n## fitting initial model\n\nThis part of the script will be useful for the real analysis, which includes fitting the logistic model, checking the model, and testing hypotheses.\n\n```{r power analysis, eval=FALSE}\nn=100\nd<- tibble(group = rep(c(\"control\", \"treatment\"), each = n))|>\n  mutate(treatment = ifelse(group == \"control\", 0, 1),\n         y         = ifelse(group == \"control\", \n                            rbinom(n,1,.2),\n                            rbinom(n,1,.1)))\n\n##########optimized code \n\n#fit a brms model with skeptical prior\nfit <-brm(data = d,\n      family = binomial,\n      y|trials(1) ~ 0+ Intercept + treatment,\n      prior = c(prior(normal(0,.5), class = b),prior(normal(0,0.5),class=b,coef=\"Intercept\")),\n      seed = 1,chains=6,iter=10000,warmup=1000,cores=4)\nplot(fit) # see chains\nprint(fit) # check rhat and model output\n\n###posterior predictive checks \npp_check(fit,type=\"stat\",stat=\"mean\")\npp_check(fit,stat=\"mean\",ndraws=50)\n\n\n# get other quantiles \nbrms_summary(fit)|>\n  data.frame()|>\n  filter(variable==\"b_treatment\")\n\n#get priors\nget_prior(fit)\n#marginal effects\n\n\n#test hypotheses\n# test treatment <0, overall benefit\nob<-hypothesis(fit,\"treatment<0\",alpha=0.025)\nob\n##### clinical benefit, treatment< log(.8)\ncb<-hypothesis(fit,\"treatment<log(0.8)\",alpha=0.025)\ncb\n\n###test for similarity ; within log(0.8)-log(1.2)\nsi1<-hypothesis(fit,\"treatment < log(1.2)\",alpha=0.025)\nsi2<-hypothesis(fit,\"treatment <log(0.8)\",alpha=0.025)\nsi1$hypothesis$Post.Prob-si2$hypothesis$Post.Prob\n\n\n\n# dobule check my understanding by manually calculating probs\nsamples<-as.data.frame(fit)\nn<-length(samples$b_treatment)\n\n#manual for overall benefit\nsum(samples$b_treatment<0)/n\n#manual for clinical benefit\nsum(samples$b_treatment<log(0.8))/n\n#similarity interval \nsum(samples$b_treatment>log(0.8) & samples$b_treatment<log(1.2))/n\n\n#### hypothesis function and manual calculations are in agreement #####\n\n##plotting out the treatment effect \nsubs<-tibble(treatment=samples$b_treatment)|>\n  mutate(Prior=\"Skeptical\")\nmean.paste<-paste(round(exp(mean(subs$treatment)),3),\" odds ratio\\n\",round(mean(subs$treatment),3),\"  log odds ratio\",sep=\"\")\nmp<-round(mean(subs$treatment),3)\n\nggplot(subs,aes(x=treatment,..scaled..))+geom_density(fill='#46A6B2',alpha=.5)+theme_bw()+xlab(\"Treatment effect (log odds ratio)\")+\n  scale_x_continuous(limits=c(-2.302585,1.61),labels =c(-2.302,ordat$logor),breaks=c(-2.302585,ordat$logor),sec.axis = dup_axis(name=\"Treatment effect (odds ratio)\",labels=c(0.1,ordat$or)))+\n  scale_y_continuous(expand=c(0,0),limits=c(0,1.3))+\n  annotate(xmin=log(.8),xmax=log(1.2),ymin=0,ymax=1.3,'rect',alpha=.5)+\n  annotate(\"text\",x=mp,y=1.15,label = mean.paste)+\n  annotate(\"text\",x=0.182,y=1.2,label=\"Similarity interval\",hjust=-.05)+ylab(\"Density\")+\n  geom_vline(xintercept = -.223,linewidth=1,lty=\"dotdash\")\n\n#########################################################\n### refit with enthusiastic prior ###################\n#########################################################\nep.fit<-brm(data = d,\n      family = binomial,\n      y|trials(1) ~ 0+ Intercept + treatment,\n      prior = c(prior(normal(log(0.8),.5), class = b),prior(normal(0,0.5),class=b,coef=\"Intercept\")),\n      seed = 1,chains=6,iter=10000,warmup=1000,cores=4)\n\n#chekcing ep.fit model \nplot(ep.fit) # see chains\nprint(ep.fit) # check rhat and model output\n\n###posterior predictive checks \npp_check(ep.fit,type=\"stat\",stat=\"mean\")\npp_check(ep.fit,stat=\"mean\",ndraws=50)\n\n\n##get posterier draws \nep.samples<-as.data.frame(ep.fit)\nep.subs<-tibble(treatment=ep.samples$b_treatment)|>\n  mutate(Prior=\"Enthusiastic\")\n\n###make combined figure \ntfit<-rbind(subs,ep.subs)\n\ntfig<-ggplot(tfit,aes(x=treatment,..scaled..,fill=Prior))+geom_density(alpha=.5)+theme_bw()+xlab(\"Treatment effect (log odds ratio)\")+\n  scale_x_continuous(limits=c(-2.302585,log(1.2)),labels =c(-2.302,ordat$logor),breaks=c(-2.302585,ordat$logor),sec.axis = dup_axis(name=\"Treatment effect (odds ratio)\",labels=c(0.1,ordat$or)))+\n  scale_y_continuous(expand=c(0,0),limits=c(0,1.3))+\n  annotate(xmin=log(.8),xmax=log(1.2),ymin=0,ymax=1.3,'rect',alpha=.5)+\n  #annotate(\"text\",x=mp,y=1.15,label = mean.paste)+\n  #annotate(\"text\",x=0.182,y=1.2,label=\"Similarity interval\",hjust=-.05)+ylab(\"Density\")+\n  geom_vline(xintercept = -.223,linewidth=1,lty=\"dotdash\")+\n  theme(legend.position = \"bottom\")+ylab(\"Scaled density\")+\n  scale_fill_manual(values=c(\"#97D3DC\",\"#F89C70\"))+\n  geom_vline(xintercept=0,linewidth=.25)\ntfig\n#####################\n###build a table to summarize the trial results\n#####################\ntbl<-tfit|>\n  group_by(Prior)|>\n  summarize(OR=round(mean(exp(treatment)),3),LCI=round(exp(quantile(treatment,probs = 0.025)),2),UCI=round(exp(quantile(treatment,probs = 0.975)),2),`Clinical Benefit`=round(sum(if_else(treatment<log(0.8),1,0))/length(treatment),2),\n            )|>\n  mutate(CI=paste(LCI,\"-\",UCI,sep=\"\"))|>\n  select(Prior,OR,CI,`Clinical Benefit`)|>\n  gt()|>tab_style(\n    style = list(\n      cell_text(weight = \"bold\",align=\"center\")\n      ),\n    locations = cells_column_labels(columns = c(Prior,OR,CI,`Clinical Benefit`))\n    ) |>\n  cols_align(\n  align = \"center\",\n  columns = everything()\n)|>\n  tab_footnote(footnote=\"Skeptical prior ~ Normal(0,0.5)\",\n               locations = cells_column_labels(columns = Prior))|>\n  tab_footnote(footnote=\"Enthusiastic prior ~ Normal(-0.2231436,0.5)\",\n               locations = cells_column_labels(columns = Prior))|>\n  tab_footnote(footnote=\"Pr(Treatment<MCID)\",\n               locations = cells_column_labels(columns = `Clinical Benefit`))|>\n  tab_footnote(footnote=\"95% Bayesian Confidence Interval\",\n               locations = cells_column_labels(columns = CI))\n\n#`Overall Benefit [Pr(Treatment <0)]`=round(sum(if_else(treatment<0,1,0))/length(treatment),2)\ntbl\ngtsave(tbl,filename=\"../02_results_figures/prior_table.png\")\n\n###############################################################\n#####combining the table into the figure \n##########################################\ncfig<-ggdraw(tfig)+draw_image(\"../02_results_figures/prior_table.png\",hjust=-.26,width=.4,height=.4,vjust=-1.2)\ncfig\n\nggsave(cfig,filename=\"../02_results_figures/rct_figure.png\",width=7,height=5,dpi=600,unit=\"in\")\n```\n\n## simulation for power analysis -\\> 1000 simulations\n\n```{r simulation and fit,eval=FALSE}\n####fit simulate and fit\n\n\nsimfit <- function(seed, n) {\n  \n  set.seed(seed)\n  \n  d<- tibble(group = rep(c(\"control\", \"treatment\"), each = n))|>\n  mutate(treatment = ifelse(group == \"control\", 0, 1),\n         y         = ifelse(group == \"control\", \n                            rbinom(n,1,.2),\n                            rbinom(n,1,.1)))\n  \n  update(fit,\n         newdata = d, \n         seed = seed) |>\n    brms_summary()|>\n  data.frame()|>\n  filter(variable==\"b_treatment\")\n    #fixef() |>\n    #data.frame() |>\n    #rownames_to_column(\"parameter\") |>\n    #filter(parameter == \"treatment\")\n}\n#actual simulations \nn_sim<-1000 # number of simulations\nsim1 <-\n  tibble(seed = 1:n_sim) %>% \n  mutate(b1 = map(seed, simfit, n = 100)) %>% \n  unnest(b1)\nsim1\n#calculate power\nsim1|> \n  mutate(check = ifelse(X95. < 0, 1, 0),\n         mcid=if_else(X80.< -0.2231436,1,0),\n         total=if_else(check&mcid==1,1,0)) |>\n  summarise(power = mean(check),power2=mean(mcid),ptotal=mean(total))\n\n\n```\n\n# session info\n\n```{r session info}\nsessionInfo()\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"00_Bayesian_priors_power_analysis.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.27","bibliography":["references.bib"],"editor":"visual","theme":"cosmo","title":"Power analysis and Bayesian priors","date":"2025-02-19"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","toc":true,"output-file":"00_Bayesian_priors_power_analysis.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"editor":"visual","documentclass":"scrreprt","title":"Power analysis and Bayesian priors","date":"2025-02-19"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}